# 分镜脚本生成UI优化 - 实现计划

## 概述

本计划将分镜脚本生成界面的优化分解为具体的编码任务，包括修复预览对话框的交互问题、简化编辑界面、以及优化视频生成对话框。

## 任务

- [x] 1. 修复 StoryboardPreviewDialog 的展开/收缩逻辑
  - 修改事件处理，防止点击文本框时触发收缩
  - 改进事件冒泡控制
  - 确保展开状态在编辑时保持
  - _需求: 1.2, 1.3, 4.1, 4.2_

- [ ]* 1.1 为展开/收缩逻辑编写单元测试
  - 测试点击文本框不会收缩
  - 测试展开状态持久化
  - _需求: 4.1, 4.2_

- [x] 2. 简化 StoryboardPreviewDialog 的编辑界面
  - 移除多语言编辑，只显示当前语言的提示词
  - 更新编辑状态管理
  - 简化 UI 布局
  - _需求: 2.1, 2.2, 2.3_

- [ ]* 2.1 为语言切换编写单元测试
  - 测试中文模式只显示中文提示词
  - 测试英文模式只显示英文提示词
  - 测试语言切换时的内容更新
  - _需求: 2.1, 2.2, 2.3_

- [x] 3. 优化 VideoGenDialog 的提示词输入
  - 简化界面，只显示两个提示词输入框（当前语言）
  - 移除多语言编辑逻辑
  - 保持模型和参数选项
  - _需求: 5.1, 5.2, 5.3, 5.4_

- [ ]* 3.1 为视频生成对话框编写单元测试
  - 测试两个提示词输入框的显示
  - 测试提示词的输入和保存
  - 测试语言切换时的界面更新
  - _需求: 5.1, 5.2, 5.3, 5.4_

- [x] 4. 移除预览和导出中的多语言功能
  - 更新预览提示词显示，只显示当前语言
  - 更新导出提示词功能，只导出当前语言
  - 实现语言切换时的内容更新
  - _需求: 6.1, 6.2, 6.3_

- [ ]* 4.1 为预览和导出编写单元测试
  - 测试预览只显示当前语言
  - 测试导出只包含当前语言
  - 测试语言切换时的更新
  - _需求: 6.1, 6.2, 6.3_

- [ ] 5. 实现 AI 脚本整合服务
  - 创建脚本整合服务，根据分镜数量整理内容
  - 实现关键内容提取逻辑
  - 实现视频提示词生成逻辑
  - _需求: 3.1, 3.2, 3.3, 3.4_

- [ ]* 5.1 为脚本整合编写属性测试
  - **属性 4: 脚本整合准确性**
  - **验证: 需求 3.1, 3.2, 3.3**

- [ ]* 5.2 为脚本整合编写属性测试
  - **属性 5: 语言保持**
  - **验证: 需求 3.4**

- [ ] 6. 集成脚本整合服务到 UI
  - 在脚本预览对话框中集成脚本整合服务
  - 在视频生成对话框中集成脚本整合服务
  - 测试完整的工作流程
  - _需求: 3.1, 3.2, 3.3, 3.4_

- [ ] 7. 检查点 - 确保所有测试通过
  - 运行所有单元测试
  - 运行所有属性测试
  - 验证交互流程
  - 如有问题，请告知用户

- [ ]* 7.1 编写集成测试
  - 测试完整的编辑流程
  - 测试视频生成流程
  - 测试多语言切换
  - _需求: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 3.1, 3.2, 3.3, 3.4, 5.1, 5.2, 5.3, 5.4, 6.1, 6.2, 6.3_

- [ ] 8. 最终检查点 - 确保所有测试通过
  - 运行所有测试
  - 验证所有需求都已实现
  - 如有问题，请告知用户

## 注意

- 标记为 `*` 的任务是可选的，可以跳过以加快 MVP 开发
- 每个任务都引用了具体的需求以便追踪
- 检查点确保增量验证
- 属性测试验证通用正确性属性
- 单元测试验证具体示例和边界情况
