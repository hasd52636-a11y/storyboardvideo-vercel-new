# 批量视频生成改进 - 实现任务清单

## 概述

本任务清单将批量视频生成改进功能分解为可执行的编码任务。

## 任务列表

- [ ] 1. 扩展数据模型和类型定义
  - 在 `types.ts` 中扩展 `VideoItem` 接口，添加场景ID、状态、错误信息等字段
  - 创建 `BatchGenerationState` 接口用于管理批量生成状态
  - 添加视频状态枚举类型
  - _需求: 1.1, 2.1, 5.1_

- [ ] 2. 创建视频状态管理器
  - 创建 `services/VideoStatusManager.ts` 文件
  - 实现 `createVideoItem()` 方法
  - 实现 `updateVideoItem()` 方法
  - 实现 `markAsFailed()` 和 `markAsSuccess()` 方法
  - _需求: 1.1, 1.2, 1.5_

- [ ] 3. 创建视频下载管理器
  - 创建 `services/VideoDownloadManager.ts` 文件
  - 实现 `downloadVideo()` 方法
  - 实现 `generateFileName()` 方法
  - 添加进度回调支持
  - _需求: 3.1, 3.2, 3.3_

- [ ] 4. 改进批量生成逻辑
  - 修改 `App.tsx` 中的 `handleGenerateVideoBatch()` 函数
  - 为每个场景分配唯一的场景ID（SC-01, SC-02 等）
  - 创建 `BatchGenerationState` 来追踪所有视频项
  - 实现单个视频生成函数 `generateVideoItem()`
  - 添加重试逻辑
  - _需求: 1.1, 1.2, 1.3, 1.4_

- [ ] 5. 创建视频卡片组件（改进）
  - 创建 `components/VideoItemCard.tsx` 组件
  - 显示场景ID
  - 显示提示词摘要（前100个字符）
  - 显示状态指示器（✓/⏳/✗/⏸）
  - 实现悬停显示完整提示词
  - 添加下载按钮（成功时）
  - 添加重新生成按钮（失败时）
  - 添加进度条（生成中时）
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 6. 创建批量生成进度组件
  - 创建 `components/BatchProgress.tsx` 组件
  - 显示进度条（已完成/总数）
  - 显示统计信息（成功/失败/总数）
  - 实现筛选选项（显示全部/仅显示失败/仅显示成功）
  - _需求: 4.1, 4.2, 4.3, 4.4_

- [ ] 7. 实现视频下载功能
  - 在 `App.tsx` 中添加 `handleDownloadVideo()` 函数
  - 集成 `VideoDownloadManager`
  - 添加下载进度显示
  - 添加下载成功/失败通知
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 8. 实现视频重新生成功能
  - 在 `App.tsx` 中添加 `handleRetryVideo()` 函数
  - 重置视频项状态
  - 重新调用生成函数
  - 更新重试计数
  - _需求: 1.3, 1.4_

- [ ] 9. 实现本地存储持久化
  - 在 `App.tsx` 中添加 `saveBatchState()` 函数
  - 在 `App.tsx` 中添加 `loadBatchState()` 函数
  - 使用 `localStorage` 保存批量生成状态
  - 在应用启动时恢复状态
  - _需求: 5.1, 5.2, 5.3, 5.4_

- [ ] 10. 集成改进的批量生成UI
  - 修改 `VideoGenDialog.tsx` 以支持新的批量生成流程
  - 更新批量生成按钮逻辑
  - 显示 `BatchProgress` 组件
  - 显示 `VideoItemCard` 列表
  - _需求: 1.1, 2.1, 4.1_

- [ ] 11. 添加错误处理和通知
  - 添加全局错误处理
  - 实现通知系统（成功/失败/信息）
  - 添加重试对话框
  - 添加过期视频处理
  - _需求: 1.2, 3.5, 5.4_

- [ ] 12. 编写单元测试
  - 测试 `VideoStatusManager` 的所有方法
  - 测试 `VideoDownloadManager` 的所有方法
  - 测试批量生成逻辑
  - 测试状态更新和持久化
  - _需求: 1.1, 1.2, 3.1, 5.1_

- [ ] 13. 编写集成测试
  - 测试端到端批量生成流程
  - 测试视频下载功能
  - 测试重新生成功能
  - 测试本地存储恢复
  - _需求: 1.1, 1.2, 1.3, 3.1, 5.1_

- [ ] 14. 部署到 Vercel
  - 提交所有代码更改
  - 运行测试确保通过
  - 部署到 Vercel
  - 验证功能在生产环境中正常工作
  - _需求: 1.1, 1.2, 1.3, 2.1, 3.1, 4.1, 5.1_

## 注意事项

- 任务标记为 `*` 的是可选任务，可以跳过以加快MVP开发
- 每个任务都应该包含相应的测试
- 所有代码更改应该遵循现有的代码风格和约定
- 确保向后兼容性，不破坏现有功能

