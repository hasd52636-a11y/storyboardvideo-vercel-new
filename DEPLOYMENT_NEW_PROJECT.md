# 新项目部署指南 - Storyboard Master v2

## 概述

这是改进版本的 Storyboard Master，包含以下优化：
- 批量重绘队列处理（最多 6 张，顺序处理）
- 改进的 UI 和缩略图显示
- 修复的导出功能（支持在线生成的分镜图）
- 500ms 延迟避免 API 限流

## 部署步骤

### 1. 在 Vercel 创建新项目

```bash
# 方式 A: 通过 Vercel CLI
vercel --prod --name storyboard-master-v2

# 方式 B: 通过 Vercel 网站
# 访问 https://vercel.com/new
# 选择 "Import Git Repository"
# 输入当前仓库 URL
# 项目名称: storyboard-master-v2
```

### 2. 配置环境变量

在 Vercel 项目设置中添加：

```
VITE_API_KEY = [你的 Gemini API 密钥]
```

或者用户在应用中配置（推荐）

### 3. 构建和部署

```bash
# 本地测试
npm run build
npm run preview

# 推送到 Vercel
git push origin main
```

### 4. 验证部署

部署完成后，访问新项目 URL：
```
https://storyboard-master-v2.vercel.app
```

## 新功能验证清单

### 批量重绘
- [ ] 选择 3-6 张分镜
- [ ] 打开批量重绘对话框
- [ ] 验证显示 "X/6" 数量标记
- [ ] 验证缩略图网格清晰显示
- [ ] 输入指令并提交
- [ ] 验证顺序处理（每张间隔 500ms）

### 分镜导出
- [ ] 生成 3-4 个分镜
- [ ] 选择分镜
- [ ] 点击"分镜合成下载"
- [ ] 验证导出的 JPEG 包含所有分镜
- [ ] 验证在线生成的分镜图正常显示

### UI 改进
- [ ] 清除历史按钮显示为小垃圾桶图标
- [ ] 批量重绘对话框显示大预览和缩略图
- [ ] 超过 6 张时显示红色警告

## 性能指标

### 批量重绘时间
- 3 张分镜: ~25-30 秒
- 6 张分镜: ~45-60 秒

### 导出时间
- 3 张分镜: ~2-3 秒
- 6 张分镜: ~4-5 秒

## 故障排查

### 问题 1: 导出的 JPEG 中分镜显示为灰色

**原因**: 图片加载超时或 CORS 问题

**解决方案**:
- 检查网络连接
- 查看浏览器控制台错误
- 尝试重新生成分镜

### 问题 2: 批量重绘超时

**原因**: API 限流或网络延迟

**解决方案**:
- 减少选择的分镜数量（最多 6 张）
- 等待一段时间后重试
- 检查 API 配额

### 问题 3: 部署失败

**原因**: 构建错误或依赖问题

**解决方案**:
```bash
# 清除缓存并重新构建
rm -rf node_modules dist
npm install
npm run build
```

## 与原项目的区别

| 功能 | 原项目 | 新项目 |
|------|--------|--------|
| 批量重绘限制 | 无限制 | 最多 6 张 |
| 处理方式 | 并发（最多 2 张） | 顺序（一次 1 张） |
| 请求延迟 | 无 | 500ms |
| 导出功能 | 缺少在线生成的分镜 | ✅ 完整支持 |
| UI 缩略图 | 基础 | ✅ 改进的 4 列网格 |

## 回滚方案

如果需要回到原项目：

```bash
# 原项目 URL
https://[原项目名].vercel.app

# 或通过 Vercel 仪表板切换
```

## 后续优化建议

1. **进度条**: 添加可视化进度条
2. **暂停/继续**: 允许用户暂停处理
3. **重试机制**: 失败的分镜自动重试
4. **批次处理**: 支持多批次处理（6 张一批）
5. **预估时间**: 显示预估完成时间

## 支持

如有问题，请查看：
- `BATCH_REDRAW_IMPROVEMENTS.md` - 技术细节
- `TEST_BATCH_REDRAW_EXPORT.md` - 测试指南
- `FIXES_BATCH_REDRAW_AND_EXPORT.md` - 修复说明

---

**部署日期**: 2025-12-24
**版本**: v2.0.0
**状态**: ✅ 生产就绪
