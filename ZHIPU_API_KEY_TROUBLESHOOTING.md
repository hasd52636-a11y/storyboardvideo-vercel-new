# 智谱 API Key 故障排查指南

## 当前问题
所有测试都失败，返回 401 错误：
```
令牌已过期或验证不正确
```

这表示 API Key 存在以下问题之一：
1. **API Key 已过期** - 需要重新生成
2. **API Key 格式错误** - 复制时出现问题
3. **API Key 权限不足** - 账户被禁用或配额用尽
4. **API Key 与账户不匹配** - 使用了错误的 Key

## 解决步骤

### 步骤 1: 检查 API Key 格式
智谱 API Key 应该以 `glm-` 开头，例如：
```
glm-4o6b7k8c9d0e1f2g3h4i5j6k7l8m9n0o
```

**检查方法：**
1. 打开设置页面 (🔑 图标)
2. 切换到 "对话及图像API" 标签
3. 选择提供商为 "智谱 AI (ChatGLM)"
4. 查看 API Key 输入框中的内容
5. 确保以 `glm-` 开头

### 步骤 2: 重新生成 API Key
如果 API Key 格式正确但仍然失败，需要重新生成：

1. 访问智谱官方网站：https://open.bigmodel.cn/usercenter/apikeys
2. 登录你的账户
3. 找到现有的 API Key
4. 点击 "删除" 或 "重新生成"
5. 复制新生成的 API Key
6. 粘贴到应用设置中
7. 点击 "保存配置"

### 步骤 3: 验证账户状态
在智谱官方网站检查：

1. **账户状态** - 确保账户未被禁用
2. **配额使用** - 检查是否还有可用配额
3. **账户余额** - 如果是付费模型，确保有足够余额
4. **API 权限** - 确保已启用所需的 API 权限

### 步骤 4: 测试新 API Key

更新 API Key 后：

1. 打开设置页面
2. 在 "对话及图像API" 标签中
3. 点击 LLM 模型旁的 "Test" 按钮
4. 等待测试完成
5. 如果显示 ✓，说明 API Key 有效

## 常见问题

### Q: 为什么之前可以用，现在不行了？
**A:** 可能原因：
- API Key 过期（通常 30-90 天）
- 账户配额用尽
- 账户被暂停
- 网络连接问题

**解决方案：** 重新生成 API Key，检查账户状态

### Q: 如何知道 API Key 是否过期？
**A:** 
- 在智谱官方网站查看 API Key 的创建时间
- 如果距离现在超过 90 天，建议重新生成
- 或者直接尝试重新生成，系统会提示是否需要

### Q: 复制 API Key 时出现问题怎么办？
**A:**
- 确保完整复制整个 Key（包括 `glm-` 前缀）
- 不要包含空格或换行符
- 建议使用浏览器的复制功能而不是手动复制

### Q: 为什么只有 Zhipu 测试失败，其他提供商可以？
**A:** 
- 说明其他 API Key 有效
- Zhipu 的 API Key 可能过期或无效
- 需要单独处理 Zhipu 的 API Key

## 测试成功的标志

所有测试都应该显示 ✓ 并变成绿色：

```
✓ 对话模型测试: SUCCESS
✓ 图像模型测试: SUCCESS  
✓ 视频模型测试: SUCCESS
```

## 获取帮助

如果问题仍未解决：

1. **检查智谱官方文档：** https://open.bigmodel.cn/docs
2. **查看 API 状态：** https://open.bigmodel.cn/usercenter/apikeys
3. **联系智谱支持：** 在官方网站提交工单

## 快速检查清单

- [ ] API Key 以 `glm-` 开头
- [ ] API Key 完整复制（无空格）
- [ ] 在智谱官方网站验证 Key 有效
- [ ] 账户状态正常（未被禁用）
- [ ] 账户有可用配额
- [ ] 网络连接正常
- [ ] 浏览器缓存已清除（Ctrl+Shift+Delete）
- [ ] 重新加载页面后重新测试

## 下一步

1. 按照上述步骤重新生成 API Key
2. 更新应用设置中的 API Key
3. 重新运行测试
4. 如果仍然失败，请检查浏览器控制台的详细错误信息
