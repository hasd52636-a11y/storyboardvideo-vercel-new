# 批量视频生成改进 - 快速总结

## 三大问题和解决方案

### 问题 1️⃣: 生成失败无法定位

```
❌ 当前:
  批量生成 → 某个失败 → 不知道是哪个 → 无法重新提交

✅ 改进后:
  批量生成 → SC-01 ✓ | SC-02 ✗ (错误信息) | SC-03 ⏳
           → 清晰定位失败 → 点击"重新生成" → 重新提交
```

**解决方案**:
- 为每个视频分配唯一的场景ID（SC-01, SC-02 等）
- 显示失败原因和错误信息
- 提供"重新生成"按钮
- 自动重试机制（最多3次）

---

### 问题 2️⃣: 视频和提示词无对应标记

```
❌ 当前:
  视频1 [无标记]
  视频2 [无标记]
  视频3 [无标记]
  ↓
  用户: 这个视频是从哪个提示词生成的？

✅ 改进后:
  SC-01 ✓
  提示词: 一个年轻女性在咖啡馆...
  [下载] [详情]
  
  SC-02 ✗
  提示词: 一个商务人士在办公室...
  错误: API 超时
  [重新生成]
```

**解决方案**:
- 显示场景ID（SC-01, SC-02 等）
- 显示提示词摘要（前100个字符）
- 悬停显示完整提示词
- 使用状态图标区分（✓/⏳/✗/⏸）

---

### 问题 3️⃣: 生成的视频没有下载按钮

```
❌ 当前:
  视频生成完成 → 只能看，不能下载 → 无法保存或分享

✅ 改进后:
  视频生成完成 → [下载] 按钮 → 下载到本地
                              → 文件名: video_SC-01_2025-12-31.mp4
```

**解决方案**:
- 添加"下载"按钮（成功时）
- 实现视频下载功能
- 显示下载进度
- 使用有意义的文件名

---

## 改进后的UI流程

### 批量生成流程

```
1. 用户输入多个提示词
   ↓
2. 点击"批量生成"
   ↓
3. 系统分配场景ID (SC-01, SC-02, SC-03...)
   ↓
4. 显示进度条和统计信息
   ┌─────────────────────────────┐
   │ 批量生成进度                 │
   │ ████████░░░░░░░░░░░░ 40%   │
   │ 成功: 2 | 失败: 0 | 待处理: 3 │
   └─────────────────────────────┘
   ↓
5. 显示视频卡片列表
   ┌──────────────────────────────┐
   │ SC-01 ✓                      │
   │ 提示词: 一个年轻女性...      │
   │ [下载] [详情]                │
   └──────────────────────────────┘
   ┌──────────────────────────────┐
   │ SC-02 ⏳ (50%)               │
   │ 提示词: 一个商务人士...      │
   │ [取消]                       │
   └──────────────────────────────┘
   ┌──────────────────────────────┐
   │ SC-03 ✗                      │
   │ 提示词: 一个老年人...        │
   │ 错误: API 超时               │
   │ [重新生成] [详情]            │
   └──────────────────────────────┘
```

---

## 核心功能

### 1. 场景ID和状态追踪

| 场景ID | 状态 | 含义 |
|--------|------|------|
| SC-01 | ✓ | 生成成功 |
| SC-02 | ⏳ | 生成中 |
| SC-03 | ✗ | 生成失败 |
| SC-04 | ⏸ | 待处理 |

### 2. 视频卡片信息

```
┌─────────────────────────────────────┐
│ SC-01 ✓                             │  <- 场景ID + 状态
├─────────────────────────────────────┤
│                                     │
│         [视频预览/占位符]           │
│                                     │
├─────────────────────────────────────┤
│ 提示词: 一个年轻女性在咖啡馆...    │  <- 提示词摘要
│ (完整提示词: 一个年轻女性在咖啡馆  │
│  坐着，喝着咖啡，看着窗外的街道... │  <- 悬停显示完整
│  )                                  │
├─────────────────────────────────────┤
│ [下载] [重新生成] [详情]            │  <- 操作按钮
└─────────────────────────────────────┘
```

### 3. 下载功能

```
用户点击 [下载]
   ↓
显示下载进度
   ↓
下载完成
   ↓
文件保存: video_SC-01_2025-12-31-12-22-35.mp4
   ↓
显示成功提示
```

### 4. 重新生成功能

```
用户点击 [重新生成]
   ↓
重置视频项状态
   ↓
重新调用生成函数
   ↓
更新重试计数
   ↓
显示新的生成进度
```

---

## 数据持久化

```
生成完成
   ↓
保存到 localStorage
   ↓
用户刷新页面
   ↓
从 localStorage 恢复
   ↓
显示之前生成的视频列表
```

---

## 实现计划

### 第一阶段: 基础设施 (3 个任务)
- [ ] 扩展数据模型
- [ ] 创建状态管理器
- [ ] 创建下载管理器

### 第二阶段: 核心功能 (6 个任务)
- [ ] 改进批量生成逻辑
- [ ] 创建视频卡片组件
- [ ] 创建进度组件
- [ ] 实现下载功能
- [ ] 实现重新生成功能
- [ ] 实现数据持久化

### 第三阶段: 集成和测试 (5 个任务)
- [ ] 集成UI
- [ ] 添加错误处理
- [ ] 编写单元测试
- [ ] 编写集成测试
- [ ] 部署到 Vercel

---

## 预期改进

### 用户体验

| 方面 | 当前 | 改进后 |
|------|------|--------|
| 失败定位 | ❌ 无法定位 | ✅ 清晰显示场景ID和错误 |
| 视频追踪 | ❌ 无对应标记 | ✅ 场景ID + 提示词摘要 |
| 视频下载 | ❌ 无法下载 | ✅ 一键下载 |
| 进度显示 | ❌ 无进度显示 | ✅ 实时进度和统计 |
| 重新生成 | ❌ 无法重新生成 | ✅ 一键重新生成 |
| 数据恢复 | ❌ 无法恢复 | ✅ 自动恢复 |

---

## 规范文件

所有规范文件已创建在 `.kiro/specs/batch-video-generation-improvements/` 目录下：

- **requirements.md** - 详细需求文档
- **design.md** - 设计文档和架构
- **tasks.md** - 实现任务清单

---

## 开始实现

准备好开始实现了吗？

1. 审查规范文档
2. 确认实现方案
3. 开始实现第一阶段任务

**下一步**: 打开 `.kiro/specs/batch-video-generation-improvements/tasks.md` 开始实现！

