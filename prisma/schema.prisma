// prisma/schema.prisma
// Define your database models

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model - matches your users table
model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  email     String   @unique
  password  String
  balance   Float    @default(10)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  transactions Transaction[]
  symbols Symbol[]
  quickStoryboardConfigs QuickStoryboardConfig[]
  generationHistory GenerationHistory[]
  actionSymbols ActionSymbol[]
  actionConfigurations ActionConfiguration[]
  multimediaAPIConfig MultimediaAPIConfig?

  @@map("users")
}

// Transaction model - matches your transactions table
model Transaction {
  id          Int      @id @default(autoincrement())
  userId      Int      @map("user_id")
  type        String
  amount      Float
  description String?
  createdAt   DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id])

  @@map("transactions")
}

// Symbol model - user-customizable symbols for storyboard
model Symbol {
  id          String   @id @default(cuid())
  userId      Int      @map("user_id")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  icon        String   // Base64 or URL
  name        String
  description String
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([userId])
  @@map("symbols")
}

// QuickStoryboardConfig model - configuration for quick storyboard generation
model QuickStoryboardConfig {
  id                           String   @id @default(cuid())
  userId                       Int      @map("user_id")
  user                         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name                         String
  description                  String
  threeViewTemplate            String   @default("Generate three orthographic views (front, side, top) of {subject}")
  multiGridTemplate            String   @default("Generate a {gridDimensions} grid storyboard with {frameCount} frames")
  styleComparisonTemplate      String   @default("Generate {subject} in 5 different artistic styles: {styles}")
  narrativeProgressionTemplate String   @default("Generate {frameCount} sequential frames showing narrative progression from: {currentContext}")
  createdAt                    DateTime @default(now()) @map("created_at")
  updatedAt                    DateTime @updatedAt @map("updated_at")

  @@index([userId])
  @@map("quick_storyboard_configs")
}

// GenerationHistory model - track all generated images
model GenerationHistory {
  id        String   @id @default(cuid())
  userId    Int      @map("user_id")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  type      String   // 'three-view', 'multi-grid', 'style-comparison', 'narrative-progression'
  prompt    String
  images    String[] // URLs or Base64
  metadata  Json     // Additional metadata like grid dimensions, styles used, etc.
  createdAt DateTime @default(now()) @map("created_at")

  @@index([userId])
  @@index([type])
  @@map("generation_history")
}

// ActionSymbol model - predefined motion actions for quick generation
model ActionSymbol {
  id          String   @id @default(cuid())
  userId      Int      @map("user_id")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name        String   // 'forward', 'rotate', 'jump', 'fly'
  icon        String   // Icon/emoji representation
  description String   // Description of the action
  prompt      String   // Prompt template for this action
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([userId])
  @@map("action_symbols")
}

// ActionConfiguration model - user's custom action configurations
model ActionConfiguration {
  id                    String   @id @default(cuid())
  userId                Int      @map("user_id")
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name                  String
  description           String
  forwardTemplate       String   @default("Generate a smooth forward motion of {subject}")
  rotateTemplate        String   @default("Generate a 360-degree rotation of {subject}")
  jumpTemplate          String   @default("Generate a jumping motion of {subject}")
  flyTemplate           String   @default("Generate a flying motion of {subject}")
  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")

  @@index([userId])
  @@map("action_configurations")
}

// MultimediaAPIConfig model - store user's multimedia API configurations
model MultimediaAPIConfig {
  id        String   @id @default(cuid())
  userId    Int      @map("user_id")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  config    Json     // Stores the full MultiMediaConfig object
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([userId])
  @@map("multimedia_api_configs")
}
