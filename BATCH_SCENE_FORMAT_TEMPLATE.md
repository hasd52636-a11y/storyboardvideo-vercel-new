# 批量场景输入格式模板

## 格式说明

用户可以使用以下格式在单个文本框中批量输入多个场景的画面描述。系统会自动识别分割点并解析成独立的场景。

## 推荐格式：使用 `<<<>>>` 标记

这是最简洁、最易识别的格式。每个场景用 `<<<` 开始，`>>>` 结束。

### 模板

```
<<<
场景1的画面描述文本。可以是多行内容。
描述场景的视觉元素、构图、光线、色彩等。
>>>

<<<
场景2的画面描述文本。可以是多行内容。
描述场景的视觉元素、构图、光线、色彩等。
>>>

<<<
场景3的画面描述文本。可以是多行内容。
描述场景的视觉元素、构图、光线、色彩等。
>>>
```

### 示例

```
<<<
一个幽静的夜晚，小屋的角落里，一只小老鼠正机警地向前探索。
它细长的胡须微微颤动，四处张望，准备冒险偷取放在桌子上的奶酪。
月光透过窗户洒在地板上，为它的行动提供了微弱的照明。
>>>

<<<
就在小老鼠快要接近奶酪时，一双闪着绿光的眼睛从阴影中浮现。
一只优雅的猫悄然出现，运用它天然的潜伏技巧，安静地接近老鼠。
猫没有急着扑过去，而是坐下来，用它的尾巴有节奏地轻轻拍打着地板。
>>>

<<<
两者对峙片刻，猫做出了意想不到的举动：它缓缓地用爪子推了推桌子上的奶酪。
小老鼠迟疑地移动了一下，又看看猫，似乎在确认这是一个意外的仁慈。
猫回头，目光柔和，似乎在传达一种不寻常的和解。
>>>
```

## 解析规则

1. **分割点识别**：系统查找 `<<<` 和 `>>>` 标记
2. **内容提取**：提取 `<<<` 和 `>>>` 之间的所有文本
3. **空白处理**：自动去除前后空白和多余换行
4. **有效性检查**：
   - 每个场景必须有 `<<<` 和 `>>>` 配对
   - 场景内容不能为空（仅空白不计）
   - 不匹配的标记会被忽略

## 替代格式（如果用户偏好）

### 格式 2：使用编号标记

```
【场景1】
场景1的画面描述...

【场景2】
场景2的画面描述...

【场景3】
场景3的画面描述...
```

### 格式 3：使用分隔线

```
---
场景1的画面描述...

---
场景2的画面描述...

---
场景3的画面描述...
```

## 推荐使用格式 1（`<<<>>>`）的原因

✅ **优点**：
- 简洁明确，易于识别
- 不与常见文本内容冲突
- 支持多行内容
- 易于在代码中正则匹配
- 与现有的双标记系统一致

❌ **其他格式的问题**：
- 格式2：【】可能与中文标点冲突
- 格式3：`---` 可能与 Markdown 分隔线冲突

## 实现细节

### 正则表达式

```typescript
// 提取所有场景
const sceneRegex = /<<<([\s\S]*?)>>>/g;
const matches = text.matchAll(sceneRegex);

// 处理每个匹配
for (const match of matches) {
  const content = match[1].trim();
  if (content.length > 0) {
    scenes.push({
      id: crypto.randomUUID(),
      visualPrompt: content
    });
  }
}
```

### 错误处理

- 不匹配的 `<<<` 或 `>>>` 被忽略
- 空场景被跳过
- 用户会收到反馈：成功解析的场景数量

## 用户体验流程

1. 用户点击"批量输入"按钮
2. 弹出一个大文本框，显示格式模板和示例
3. 用户粘贴或输入内容
4. 点击"解析"按钮
5. 系统解析并显示识别到的场景数量
6. 用户可以编辑或确认
7. 点击"生成画面"开始生成

