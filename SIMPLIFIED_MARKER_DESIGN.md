# 简化标记设计 - 易于识别和提取

## 问题分析
原始标记 `**##@@` 和 `*】` 过于复杂，容易出错。需要设计更简洁的标识。

---

## 新设计方案

### 方案一：使用 [SCENE] 和 [/SCENE]

**优点**: 清晰、易读、易提取

```
[SCENE]
场景内容...
[/SCENE]
```

**提取正则**:
```typescript
/\[SCENE\](.*?)\[\/SCENE\]/gs
```

**示例**:
```
[SCENE]
在一个幽静的夜晚，小屋的角落里，一只小老鼠正机警地向前探索。
[/SCENE]
[SCENE]
就在小老鼠快要接近奶酪时，一双闪着绿光的眼睛从阴影中浮现。
[/SCENE]
[SCENE]
两者对峙片刻，猫做出了意想不到的举动。
[/SCENE]
```

---

### 方案二：使用 ===START=== 和 ===END===

**优点**: 视觉分隔明显

```
===START===
场景内容...
===END===
```

**提取正则**:
```typescript
/===START===(.*?)===END===/gs
```

**示例**:
```
===START===
在一个幽静的夜晚，小屋的角落里，一只小老鼠正机警地向前探索。
===END===
===START===
就在小老鼠快要接近奶酪时，一双闪着绿光的眼睛从阴影中浮现。
===END===
===START===
两者对峙片刻，猫做出了意想不到的举动。
===END===
```

---

### 方案三：使用 <<< 和 >>>（推荐）

**优点**: 最简洁、最易识别、最易输入

```
<<<
场景内容...
>>>
```

**提取正则**:
```typescript
/<<<(.*?)>>>/gs
```

**示例**:
```
<<<
在一个幽静的夜晚，小屋的角落里，一只小老鼠正机警地向前探索。
>>>
<<<
就在小老鼠快要接近奶酪时，一双闪着绿光的眼睛从阴影中浮现。
>>>
<<<
两者对峙片刻，猫做出了意想不到的举动。
>>>
```

---

### 方案四：使用 --- 和 ---（最简洁）

**优点**: 最简洁，类似Markdown分隔符

```
---
场景内容...
---
```

**提取正则**:
```typescript
/---(.*?)---/gs
```

**示例**:
```
---
在一个幽静的夜晚，小屋的角落里，一只小老鼠正机警地向前探索。
---
---
就在小老鼠快要接近奶酪时，一双闪着绿光的眼睛从阴影中浮现。
---
---
两者对峙片刻，猫做出了意想不到的举动。
---
```

---

## 推荐方案：方案三 <<<  >>>

### 理由
1. **最简洁** - 只需3个字符
2. **易识别** - 视觉上清晰的箭头指向
3. **易输入** - 键盘快速输入
4. **不冲突** - 不会与常见文本冲突
5. **易提取** - 正则表达式简单

---

## 系统提示词（使用 <<< >>> 标记）

### 中文版本
```
**文 你是一位创意故事编剧。用户会给你一个故事概念或简短描述。

【你的任务】
根据用户的输入，创作一个完整的故事，分成指定数量的场景。

【返回格式要求】
每个场景必须按照以下格式返回：

<<<
场景的完整描述和内容...
>>>

【格式说明】
- 开始标记：<<< （三个小于号）
- 内容：场景的完整描述，可以多行
- 结束标记：>>> （三个大于号）
- 每个场景之间直接相连，不要有空行或其他文本

【内容要求】
1. 每个场景描述要详细生动，200-300字
2. 场景之间要有逻辑连接和故事递进
3. 保持故事的完整性和连贯性
4. 不要在格式标记外添加任何其他文本
5. 不要添加编号、序号或其他标记

【示例】
<<<
故事开场的场景描述...
>>>
<<<
故事发展的场景描述...
>>>
<<<
故事高潮的场景描述...
>>>
```



---

## 提取函数（使用 <<< >>> 标记）

```typescript
export const extractScenesBySimpleMarker = (text: string): ScriptScene[] => {
  console.log('[extractScenesBySimpleMarker] 开始提取场景...');
  
  // 使用简单的 <<< >>> 标记
  const scenePattern = /<<<(.*?)>>>/gs;
  const scenes: ScriptScene[] = [];
  
  let match;
  let index = 0;
  
  while ((match = scenePattern.exec(text)) !== null) {
    const content = match[1].trim();
    
    if (content.length === 0) {
      console.warn(`[extractScenesBySimpleMarker] 跳过空场景`);
      continue;
    }
    
    console.log(`[extractScenesBySimpleMarker] ✅ 提取场景 ${index + 1}`);
    console.log(`[extractScenesBySimpleMarker]   内容长度: ${content.length} 字符`);
    
    scenes.push({
      index,
      description: content,
      visualPrompt: content,
      videoPrompt: '',
      videoPromptEn: ''
    });
    
    index++;
  }
  
  console.log(`[extractScenesBySimpleMarker] ✅ 总共提取 ${scenes.length} 个场景`);
  return scenes;
};
```

---

## 测试示例

### AI返回内容
```
<<<
在一个幽静的夜晚，小屋的角落里，一只小老鼠正机警地向前探索。它细长的胡须微微颤动，四处张望，准备冒险偷取放在桌子上的奶酪。月光透过窗户洒在地板上，为它的行动提供了微弱的照明。小老鼠心跳加速，屏住呼吸，朝目标迈出了勇敢的一步。
>>>
<<<
就在小老鼠快要接近奶酪时，一双闪着绿光的眼睛从阴影中浮现。一只优雅的猫悄然出现，运用它天然的潜伏技巧，安静地接近老鼠。猫没有急着扑过去，而是坐下来，用它的尾巴有节奏地轻轻拍打着地板，发出了一种让人感到威胁的低沉声响。小老鼠停止了一切动作，紧张地盯着猫，眼神里充满了恐惧与惊讶。
>>>
<<<
两者对峙片刻，猫做出了意想不到的举动：它缓缓地用爪子推了推桌子上的奶酪，示意小老鼠可以放心享用。小老鼠迟疑地移动了一下，又看看猫，似乎在确认这是一个意外的仁慈。猫回头，目光柔和，似乎在传达一种不寻常的和解。小老鼠最终鼓起勇气，快速地叼起奶酪，消失在墙角，而猫则转身，继续它的夜间巡视，宛如一位宽容的守护者。
>>>
```

### 提取结果
```json
{
  "scenes": [
    {
      "index": 0,
      "description": "在一个幽静的夜晚...",
      "visualPrompt": "在一个幽静的夜晚..."
    },
    {
      "index": 1,
      "description": "就在小老鼠快要接近奶酪时...",
      "visualPrompt": "就在小老鼠快要接近奶酪时..."
    },
    {
      "index": 2,
      "description": "两者对峙片刻...",
      "visualPrompt": "两者对峙片刻..."
    }
  ],
  "totalScenes": 3
}
```

---

## 优势总结

✅ **简洁** - 只需 <<< 和 >>>
✅ **易识别** - 清晰的视觉标记
✅ **易提取** - 简单的正则表达式
✅ **易输入** - 快速键盘输入
✅ **不冲突** - 不会与常见文本冲突
✅ **易扩展** - 支持任意数量的场景
✅ **容错性强** - 自动处理空格和换行

---

## 选择建议

| 方案 | 简洁度 | 易识别 | 易提取 | 推荐度 |
|------|--------|--------|--------|--------|
| 方案一 [SCENE] | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| 方案二 ===START=== | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ |
| 方案三 <<< >>> | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 方案四 --- --- | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |

**最终推荐：方案三 <<< >>>**
