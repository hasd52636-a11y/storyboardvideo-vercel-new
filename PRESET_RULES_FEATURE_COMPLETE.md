# 预制规则功能实现完成

## 功能概述

在脚本创作输入框上方添加了两个预制规则按钮，用户可以快速应用预定义的提示词规则。

## 实现细节

### 1. 新增状态管理
- `selectedRule`: 跟踪当前选中的规则 ('rule1' | 'rule2' | null)

### 2. 规则按钮 UI
在输入框上方添加了两个按钮：

**规则1：一键脚本 (📝 Script)**
- 颜色：绿色（选中时）
- 包含 SORA 2 全局提示词规则
- 涵盖内容：
  - 全局参考锁定
  - 多镜头动态摄像
  - 内联角色描述和对话
  - BGM、SFX 和节奏
  - 对话顺序锁定
  - 零旁白和角色限制

**规则2：反推提示词 (🔍 Reverse)**
- 颜色：蓝色（选中时）
- 用于从参考图像反推生成 prompt
- 涵盖内容：
  - 主体描述
  - 背景场景
  - 构图与视角
  - 光线与颜色
  - 纹理与材质
  - 氛围与情绪
  - 风格与艺术性
  - 摄影参数
  - 生成参数
  - 负面约束

### 3. 交互流程

1. **选择规则**
   - 用户点击规则按钮
   - 按钮变色提示已选中
   - 再次点击可取消选择

2. **输入内容**
   - 用户在输入框中输入自己的内容
   - 可以同时上传参考图片

3. **发送消息**
   - 点击发送按钮或按 Enter
   - 系统自动将选中的规则与用户输入合并
   - 格式：`[规则内容]\n\n用户输入：\n[用户内容]`
   - 发送后自动清除规则选择

### 4. 代码改动

**文件：components/SidebarRight.tsx**

- 添加状态：`const [selectedRule, setSelectedRule] = useState<'rule1' | 'rule2' | null>(null);`
- 添加规则按钮 UI（在输入框上方）
- 修改 `handleSendChat` 函数以包含规则内容

## 使用场景

### 规则1 - 一键脚本
适用于：
- 生成 SORA 2 视频脚本
- 需要遵循特定视频生成规范
- 确保角色、对话、摄像机指令的一致性

### 规则2 - 反推提示词
适用于：
- 从参考图像生成详细的 prompt
- 需要精确控制图像生成的各个方面
- 确保生成的图像与参考图像一致

## 视觉反馈

- **未选中状态**：浅色背景，半透明文字
- **选中状态**：彩色背景（绿色/蓝色），白色文字，带阴影效果
- **悬停效果**：边框颜色变化，文字颜色变化

## 部署信息

- **部署时间**：2025-12-31
- **部署环境**：Vercel
- **生产 URL**：https://sora.wboke.com
- **状态**：✅ 已上线

## 后续优化建议

1. 可以添加更多预制规则
2. 支持用户自定义规则
3. 添加规则预览功能
4. 支持规则的启用/禁用切换
5. 添加规则使用统计
