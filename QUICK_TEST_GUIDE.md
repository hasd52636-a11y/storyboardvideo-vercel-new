# 🧪 快速测试指南 - v3 版本

**测试时间**: 2025年12月25日  
**版本**: v3 (CORS 修复 + 提示词集成)

---

## 🚀 快速开始

### 访问应用

打开浏览器访问: **https://sora.wboke.com**

---

## 📋 测试清单

### ✅ 测试 1: 导出分镜图 (5 分钟)

**目标**: 验证 CORS 代理修复

**步骤**:
1. 生成 3 张分镜图
   - 点击左侧"生成分镜"
   - 输入提示词或选择风格
   - 等待图片生成

2. 选中所有分镜
   - Ctrl+A 或手动选择

3. 导出 JPEG
   - 右键 → "导出 JPEG"
   - 或点击右侧"导出"按钮

4. 验证结果
   - ✅ 图片正确加载（不是蓝色框）
   - ✅ 显示场景编号（SC-01, SC-02 等）
   - ✅ 文件成功下载

**预期结果**:
```
✅ 导出成功
✅ 图片清晰可见
✅ 没有蓝色占位符
```

**如果失败**:
- 检查网络连接
- 刷新页面重试
- 查看浏览器控制台 (F12) 是否有错误

---

### ✅ 测试 2: 生成视频提示词 (3 分钟)

**目标**: 验证提示词自动加载

**步骤**:
1. 生成 3-5 张分镜图

2. 选中所有分镜
   - Ctrl+A 或手动选择

3. 点击"生成视频"按钮
   - 右侧工具栏中的"生成视频"
   - 或右键菜单中的"生成视频"

4. 查看 VideoGenDialog
   - 检查提示词是否自动加载
   - 验证提示词格式

5. 验证结果
   - ✅ 提示词自动加载
   - ✅ 包含全局指令
   - ✅ 包含所有场景信息
   - ✅ 用户可以编辑

**预期提示词格式**:
```
【全局指令】必须按照以下规则生成视频：
1、禁止将参考图写入画面...
2、保持写实摄影风格
3、16:9画幅
【限制性指令】禁止闪烁...
【约束条件】不修改参考主体特征...

【SC-01】
[画面描述]: ...
[摄像机语言]: ...

【SC-02】
...
```

**如果失败**:
- 确保选中了至少一个分镜
- 刷新页面重试
- 查看浏览器控制台错误

---

### ✅ 测试 3: 批量重绘 (5 分钟)

**目标**: 验证批量重绘支持多张分镜

**步骤**:
1. 生成 2-3 张分镜图

2. 选中所有分镜
   - Ctrl+A 或手动选择

3. 右键点击任意分镜
   - 选择"批量重绘"

4. 输入改进指令
   ```
   SC-01: 加入更多细节
   SC-02: 改成夜间场景
   SC-03: 增加光效
   ```

5. 点击"提交"

6. 验证结果
   - ✅ 所有分镜都被重绘
   - ✅ 显示成功/失败统计
   - ✅ 每张之间有延迟

**预期结果**:
```
✅ 批量重绘完成：成功 3 张
```

**如果失败**:
- 减少选中的分镜数量（最多 6 张）
- 等待一段时间后重试
- 查看浏览器控制台日志

---

### ⏳ 测试 4: 多分镜视频生成 (可选，需要 45-50 分钟)

**目标**: 验证长时间视频生成不超时

**步骤**:
1. 生成 5 张分镜图

2. 选中所有分镜

3. 点击"生成视频"

4. 在 VideoGenDialog 中
   - 验证提示词已加载
   - 选择模型（推荐 Sora 2 Pro）
   - 设置时长（15-25 秒）
   - 点击"生成"

5. 打开浏览器控制台 (F12)
   - 查看 Console 标签
   - 观察轮询日志

6. 等待视频生成完成
   - 预计 45-50 分钟
   - 保持浏览器打开

7. 验证结果
   - ✅ 视频正常生成
   - ✅ 没有超时错误
   - ✅ 视频 URL 正确返回
   - ✅ 可以播放视频

**控制台日志示例**:
```
[Video Polling] Task: sora-2:9c957108-9604-4338-b861-2de45642a67a
  Status: IN_PROGRESS
  Progress: 25%
  Elapsed: 120s / 3600s

[Video Polling] Task: sora-2:9c957108-9604-4338-b861-2de45642a67a
  Status: IN_PROGRESS
  Progress: 50%
  Elapsed: 1500s / 3600s

[Video Polling] Task: sora-2:9c957108-9604-4338-b861-2de45642a67a
  Status: SUCCESS
  Progress: 100%
  Elapsed: 2921s / 3600s
```

**如果失败**:
- 检查网络连接
- 减少分镜数量
- 在网络稳定的时间重试

---

## 🔍 浏览器控制台检查

### 打开控制台

按 **F12** 或右键 → "检查元素" → "Console" 标签

### 查看日志

**导出分镜图日志**:
```
✓ Image drawn successfully: https://maas-watermark-prod...
✓ Frame 1 loaded successfully
✓ Frame 2 loaded successfully
```

**生成视频日志**:
```
[Video Polling] Task: video_xxx
  Status: IN_PROGRESS
  Progress: 25%
  Elapsed: 120s / 3600s
```

**批量重绘日志**:
```
[SC-01] 开始生成... (1/3)
[SC-01] ✓ 生成成功
[SC-02] 开始生成... (2/3)
[SC-02] ✓ 生成成功
```

### 常见错误

**CORS 错误**:
```
Image load failed for URL: https://maas-watermark-prod...
Retrying with CORS proxy 1...
```
→ 这是正常的，系统会自动重试

**超时错误**:
```
Image load timeout: https://maas-watermark-prod...
Retrying with CORS proxy 2...
```
→ 这是正常的，系统会尝试下一个代理

---

## 📊 测试结果记录

### 测试 1: 导出分镜图
- [ ] 图片正确加载
- [ ] 没有蓝色框
- [ ] 场景编号显示正确
- [ ] 文件成功下载

**结果**: ___________

### 测试 2: 生成视频提示词
- [ ] 提示词自动加载
- [ ] 包含全局指令
- [ ] 包含所有场景
- [ ] 用户可编辑

**结果**: ___________

### 测试 3: 批量重绘
- [ ] 所有分镜都被重绘
- [ ] 显示成功统计
- [ ] 没有错误

**结果**: ___________

### 测试 4: 多分镜视频 (可选)
- [ ] 视频正常生成
- [ ] 没有超时
- [ ] 视频可播放

**结果**: ___________

---

## 🎯 快速问题排查

| 问题 | 解决方案 |
|------|---------|
| 导出显示蓝色框 | 检查网络，等待 CORS 代理重试 |
| 提示词没有加载 | 确保选中分镜，刷新页面 |
| 批量重绘只重绘一张 | 减少分镜数量，等待后重试 |
| 视频生成超时 | 检查网络，减少分镜数量 |

---

## 📞 反馈

如果遇到问题，请记录：
1. 具体操作步骤
2. 浏览器控制台错误信息
3. 网络连接状态
4. 浏览器版本

---

**测试指南完成**: 2025-12-25  
**版本**: v3  
**预计测试时间**: 15-20 分钟（不含多分镜视频生成）

