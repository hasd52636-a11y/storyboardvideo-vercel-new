# 🐛 应用问题总结

**记录时间**: 2025年12月25日  
**应用**: Storyboard Master - 分镜生成工具

---

## 问题列表

### 1️⃣ 导出分镜图功能 - 只显示蓝色框，没有图片

**问题描述**:
- 导出分镜图后，下载的JPEG文件中只显示蓝色框
- 没有实际的分镜图片内容

**可能原因**:
- CORS 问题导致图片无法加载到 Canvas
- 图片加载超时
- Canvas 被污染（Tainted Canvas）

**影响范围**: 导出功能完全不可用

**优先级**: 🔴 高

---

### 2️⃣ 生成视频按钮 - 缺少提示词加载

**问题描述**:
- 生成视频按钮中没有加载对应分镜的提示词
- 应该与"预览提示词"功能使用相同的提示词逻辑

**建议方案**:
- 复用 `getOptimizedPrompts()` 函数
- 在 VideoGenDialog 中自动填充提示词
- 保持提示词逻辑一致

**影响范围**: 视频生成功能不完整

**优先级**: 🟡 中

---

### 3️⃣ 视频生成速度慢 - 原因分析

**问题描述**:
- 视频生成很慢
- 加载很慢

**可能原因分析**:

| 原因 | 概率 | 说明 |
|------|------|------|
| **API 提供方** | 🔴 高 | Sora2 API 本身处理时间长 |
| **网络延迟** | 🟡 中 | 国内访问国外服务器延迟 |
| **服务器问题** | 🟡 中 | Vercel 服务器响应慢 |
| **软件问题** | 🟢 低 | 代码逻辑效率问题 |

**建议**:
- 添加详细的性能日志
- 记录各个阶段的耗时
- 检查 API 响应时间

**优先级**: 🟡 中

---

### 4️⃣ 批量重绘功能 - 只重绘一张图

**问题描述**:
- 选定多张图片后点击"批量重绘"
- 只有一张图被重绘
- 没有显示多图的缩略图和对应提示词

**可能原因**:
- 批量重绘逻辑只处理了第一张图
- 循环逻辑有问题
- 提示词生成逻辑不支持多图

**影响范围**: 批量操作功能不可用

**优先级**: 🔴 高

---

### 5️⃣ 生成视频提交方式 - 不清楚

**问题描述**:
- 不清楚生成视频时提交的是：
  - 单张图片？
  - 多张图片？
  - 多张图片合成后的单张图？

**需要确认**:
- 当前实现方式
- API 期望的输入格式
- 是否需要修改

**影响范围**: 视频生成逻辑理解

**优先级**: 🟡 中

---

### 6️⃣ 视频生成状态不同步 - API成功但网站显示失败

**问题描述**:
- API 源头查询显示生成成功
- 网站上显示失败
- 进度显示 100% 但预览画面没显示
- 前 5 秒视频正常，后续没有

**可能原因**:

1. **状态查询问题**
   - 轮询逻辑有问题
   - 状态判断条件错误
   - 超时设置不合理

2. **视频加载问题**
   - 视频 URL 获取失败
   - 视频文件不完整
   - 浏览器缓存问题

3. **API 响应问题**
   - API 返回的视频 URL 无效
   - 视频文件被截断
   - 服务器返回错误的状态码

4. **前端显示问题**
   - 视频播放器配置错误
   - CORS 问题
   - 视频格式不支持

**症状分析**:
- 前 5 秒正常 → 视频文件可能被截断
- 进度 100% 但无预览 → 状态判断错误或 URL 无效

**影响范围**: 视频预览功能不可用

**优先级**: 🔴 高

---

## 问题优先级排序

| 优先级 | 问题 | 影响 |
|--------|------|------|
| 🔴 高 | 导出分镜图只显示框 | 导出功能完全不可用 |
| 🔴 高 | 批量重绘只重绘一张 | 批量操作不可用 |
| 🔴 高 | 视频生成状态不同步 | 视频预览不可用 |
| 🟡 中 | 生成视频缺少提示词 | 功能不完整 |
| 🟡 中 | 视频生成速度慢 | 用户体验差 |
| 🟡 中 | 不清楚提交方式 | 需要确认逻辑 |

---

## 建议修复顺序

1. **第一阶段** (立即修复)
   - [ ] 修复导出分镜图 CORS 问题
   - [ ] 修复批量重绘逻辑
   - [ ] 修复视频状态同步问题

2. **第二阶段** (优化功能)
   - [ ] 添加提示词到生成视频
   - [ ] 优化视频生成速度
   - [ ] 添加性能日志

3. **第三阶段** (完善体验)
   - [ ] 确认提交方式
   - [ ] 添加错误提示
   - [ ] 优化用户反馈

---

## 技术调查清单

### 导出分镜图问题
- [ ] 检查 Canvas CORS 设置
- [ ] 验证图片加载超时时间
- [ ] 测试本地图片 vs 远程图片
- [ ] 检查 Canvas.toBlob() 错误处理

### 批量重绘问题
- [ ] 查看 BatchRedrawDialog 组件逻辑
- [ ] 检查循环是否正确
- [ ] 验证提示词生成是否支持多图

### 视频状态同步问题
- [ ] 检查轮询逻辑
- [ ] 验证状态判断条件
- [ ] 测试 API 响应格式
- [ ] 检查视频 URL 有效性
- [ ] 验证视频文件完整性

### 性能问题
- [ ] 添加性能监控
- [ ] 记录各阶段耗时
- [ ] 检查 API 响应时间
- [ ] 分析网络延迟

---

## 相关代码文件

| 问题 | 相关文件 |
|------|---------|
| 导出分镜图 | App.tsx (handleExportJPEG) |
| 生成视频 | VideoGenDialog.tsx |
| 批量重绘 | BatchRedrawDialog.tsx |
| 视频状态 | videoService.ts |
| 提示词 | App.tsx (getOptimizedPrompts) |

---

## 下一步行动

1. **立即**: 创建 Bug 修复任务
2. **本周**: 修复高优先级问题
3. **下周**: 优化功能和性能
4. **持续**: 添加监控和日志

---

**记录人**: 用户反馈  
**状态**: 待修复  
**最后更新**: 2025-12-25
