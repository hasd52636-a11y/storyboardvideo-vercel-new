<div align="center">
<img width="1200" height="475" alt="GHBanner" src="https://github.com/user-attachments/assets/0aa67016-6eaf-458a-adb2-6e31a0763ed6" />
</div>

# 分镜大师 - AI 智能分镜创作平台

Storyboard Master - AI-Powered Storyboarding Platform

<div align="center">
<img width="1200" height="475" alt="GHBanner" src="https://github.com/user-attachments/assets/0aa67016-6eaf-458a-adb2-6e31a0763ed6" />
</div>

## 🎬 功能特性

- **🤖 AI 智能生成**：支持 Gemini、OpenAI、智谱等多个 AI 模型
- **📐 动态比例**：支持 7 种画面比例（16:9、9:16、21:9、1:1 等）
- **🎨 多种风格**：电影、科幻、赛博朋克、水墨、动漫等 11 种风格
- **📝 双模式生成**：剧本生成 + 创意对话
- **🎯 参考主体**：保持角色一致性
- **📸 智能导出**：自动生成分镜合成图
- **🎬 视频生成**：支持 Sora 2 视频生成（单个 + 批量）
- **🌙 深浅主题**：支持深色/浅色模式
- **🌍 多语言**：中文/English

## 🚀 快速开始

### 前置要求
- Node.js 16+
- 任意 AI 服务的 API Key（Gemini、OpenAI、智谱等）

### 本地运行

1. **安装依赖**
   ```bash
   npm install
   ```

2. **配置 API**
   - 编辑 `.env.local` 文件
   - 设置 `GEMINI_API_KEY` 或其他 AI 服务的 API Key

3. **启动开发服务器**
   ```bash
   npm run dev
   ```

4. **打开浏览器**
   - 访问 `http://localhost:5173`

## 📐 画面比例功能

### 支持的比例

| 比例 | 用途 | 示例 |
|------|------|------|
| **16:9** | 电影、电视、YouTube | 标准宽屏 |
| **9:16** | 短视频、手机 | TikTok、抖音 |
| **21:9** | 电影级效果 | 超宽屏 |
| **1:1** | 社交媒体 | Instagram、微博 |
| **4:3** | 演讲、教学 | 传统比例 |
| **4:5** | 特定平台 | Pinterest |
| **3:2** | 创意需求 | 其他格式 |

### 使用示例

#### 生成电影分镜（16:9）
```
1. 切换到"剧本生成"
2. 输入电影剧本
3. 选择比例：16:9
4. 点击"开始生成"
```

#### 生成手机短视频（9:16）
```
1. 切换到"创意对话"
2. 输入创意想法
3. 选择比例：9:16
4. 点击"生成分镜"
```

#### 混合比例工作流
```
1. 生成一组 16:9 的分镜（电影用）
2. 再生成一组 9:16 的分镜（手机用）
3. 分别导出不同比例的分镜
```

**⚠️ 重要**：导出时所有分镜必须是同一比例

### 详细指南

查看 [ASPECT_RATIO_USAGE_GUIDE.md](./ASPECT_RATIO_USAGE_GUIDE.md) 了解完整的比例功能使用说明。

## 📖 使用说明

### 两种生成模式

#### 1️⃣ 剧本生成模式
- 适合有完整脚本的情况
- 输入剧本 → 选择参数 → 自动生成分镜
- 支持参考主体保持角色一致性

#### 2️⃣ 创意对话模式
- 适合逐步构思的情况
- 与 AI 对话 → 完善细节 → 生成分镜
- 支持多轮对话融合

### 核心功能

- **参考主体**：上传角色图片，保持生成分镜中的角色一致
- **风格选择**：11 种预设风格，满足不同创意需求
- **颜色模式**：彩色/黑白素描，适应不同工作阶段
- **分镜编辑**：拖拽、缩放、重绘、克隆等操作
- **智能导出**：自动排版、编号、合成为 JPEG
- **视频生成**：从分镜生成视频（支持 Sora 2）

### 视频生成功能

#### 单个视频生成
```
1. 选择分镜
2. 点击「生成视频」按钮
3. 选择视频参数（模型、宽高比、时长等）
4. 点击「生成」
5. 视频自动下载
```

#### 批量视频生成
```
1. 准备 TXT 文件（用 ****** 分隔多个脚本）
2. 点击「生成视频」→ 勾选「批量生成」
3. 上传 TXT 文件
4. 设置参数：
   • 视频语言（控制对话和字幕）
   • 视频间隔（5-60 分钟）
   • 下载目录
5. 检查脚本数量（最多 50 个）
6. 点击「生成」
7. 对话框最小化为浮窗，显示进度（2/5）
8. 所有视频自动下载
```

**关键特性：**
- ✅ 最多 50 个视频/次（防止配额耗尽）
- ✅ 实时进度显示（浮窗）
- ✅ 自动使用参考分镜保持角色一致
- ✅ 支持设置视频语言（中文、英文等）
- ✅ 支持设置视频间隔时间（避免 API 限制）
- ✅ 生成过程中可继续操作画布

#### 如何编写高质量的视频脚本

为了生成高质量的视频，需要编写结构清晰的脚本。推荐使用以下提示词模板与 AI 协作：

**提示词模板：**
```
帮我设计【数字】个脚本，每个脚本限制在760字以内，讲述【故事主题】的故事，每个故事【数字】个画面，每个画面一个单独段落。【数字】个连续故事
```

**使用示例：**
```
帮我设计3个脚本，每个脚本限制在760字以内，讲述科技创新改变生活的故事，每个故事5个画面，每个画面一个单独段落。3个连续故事
```

**脚本编写要点：**
1. **明确主题**：每个脚本要有清晰的故事线
2. **画面分段**：每个画面用单独段落表示，便于理解视觉转换
3. **字数控制**：每个脚本不超过 760 字，确保生成质量
4. **连贯性**：多个脚本可形成连续故事，增强叙事效果
5. **视觉描写**：包含具体的场景、人物、动作描写

**脚本结构示例：**
```
【画面1】
场景描写：在现代办公室里，一位年轻工程师坐在电脑前...
动作描写：她快速敲击键盘，屏幕上显示代码...

【画面2】
场景描写：转到实验室，团队成员围在一起...
动作描写：他们讨论方案，指向白板上的设计图...

【画面3】
...
```

**批量生成工作流：**
1. 使用提示词与 AI 生成多个脚本
2. 将脚本复制到 TXT 文件，用 `******` 分隔
3. 上传到批量生成功能
4. 设置视频语言和间隔时间
5. 点击生成，等待所有视频完成

### 智慧客服

分镜大师内置智慧客服功能，帮助你快速解决使用问题。

**如何使用智慧客服：**
1. 在创意对话模式中，点击「智慧客服」按钮
2. 按钮会变成蓝色，表示已激活
3. 输入你的问题或需求
4. AI 会根据应用内的帮助文档为你解答

**智慧客服可以帮助你：**
- 解答如何使用各项功能
- 提供最佳实践建议
- 回答常见问题
- 指导工作流程

**示例问题：**
- "如何生成视频？"
- "批量生成最多支持多少个视频？"
- "如何编写高质量的脚本？"
- "如何保持角色一致性？"

### 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+A` | 全选所有分镜 |
| `Shift+点击` | 逐个选择分镜 |
| `鼠标框选` | 框选多张分镜 |
| `Ctrl+滚轮` | 缩放画布 |

## 🔧 API 配置

### 支持的 AI 服务

- **Gemini**（推荐）：官方高性能引擎
- **OpenAI**：GPT-4o + DALL-E-3
- **智谱 AI**：ChatGLM + CogView
- **通义千问**：Qwen + 通义万相
- **DeepSeek**：DeepSeek Chat
- **自定义**：任何 OpenAI 兼容的 API

### 配置步骤

1. 启动应用后进入设置
2. 选择 AI 服务商
3. 输入 API Key 和模型名称
4. 点击 Test 验证配置
5. 保存配置

## 📦 部署

### 部署到 Vercel

```bash
vercel deploy
```

### 部署到其他平台

```bash
npm run build
# 将 dist 文件夹部署到任何静态托管服务
```

## 🎨 自定义

### 修改风格

编辑 `types.ts` 中的 `STYLES` 数组：

```typescript
export const STYLES: StyleOption[] = [
  { 
    id: 'custom', 
    name: 'Custom Style', 
    nameZh: '自定义风格',
    color: '#FF0000',
    description: 'Your description',
    descriptionZh: '你的描述'
  },
  // ... 更多风格
];
```

### 修改比例

编辑 `types.ts` 中的 `AspectRatio` 类型：

```typescript
export type AspectRatio = '16:9' | '4:3' | '9:16' | '1:1' | '21:9' | '4:5' | '3:2' | '你的比例';
```

## 🐛 常见问题

**Q: 为什么导出时提示"分镜必须是同一个比例"？**  
A: 系统要求导出的所有分镜使用同一比例。如果混合了不同比例，需要分别导出。

**Q: 如何在同一画布中混合不同比例？**  
A: 完全支持！画布可以包含多个比例的分镜，但导出时必须选择同一比例。

**Q: 调整分镜大小时，比例会改变吗？**  
A: 不会。系统会自动保持原有的比例。

**Q: 如何为不同平台生成分镜？**  
A: 根据平台选择对应的比例：YouTube(16:9)、TikTok(9:16)、Instagram(1:1) 等。

**Q: 视频生成需要什么配置？**  
A: 需要在设置中配置视频 API。支持多个视频 API 提供商。

**Q: 单个视频生成需要多长时间？**  
A: 通常 2-5 分钟，取决于模型和参数。Pro 模型和高清选项会耗时更长。

**Q: 批量生成最多支持多少个视频？**  
A: 最多 50 个视频/次。这是为了防止用户意外耗尽配额和浏览器崩溃。

**Q: 超过 50 个脚本怎么办？**  
A: 系统会禁用「生成」按钮并显示警告。需要删除多余脚本后才能生成。

**Q: 批量生成 50 个视频需要多长时间？**  
A: 取决于间隔时间设置。如果间隔 15 分钟，50 个视频需要约 12-13 小时。

**Q: 如何设置视频语言？**  
A: 在批量生成对话框中，输入语言名称（最多 8 字符）。系统会生成该语言的对话和字幕。

**Q: 参考分镜有什么作用？**  
A: 保持所有生成视频中的角色/产品一致。系统会自动使用第一张分镜作为参考。

**Q: 视频间隔时间有什么用？**  
A: 避免 API 速率限制。每个视频生成后等待指定时间再生成下一个。

**Q: 生成过程中可以关闭浏览器吗？**  
A: 不建议。关闭浏览器会中断生成过程。建议等待生成完成。

**Q: 视频会自动下载吗？**  
A: 是的。生成完成后会自动下载到浏览器默认目录。

**Q: 如何查看生成进度？**  
A: 对话框最小化为浮窗后，显示进度（2/5）。点击浮窗可展开查看详情。

**Q: Sora 2 和 Sora 2 Pro 有什么区别？**  
A: Sora 2 是标准模型，生成速度快。Sora 2 Pro 是专业模型，质量更高，支持高清选项。

更多问题请查看应用内的完整使用说明。

## 📚 文档

- [完整使用指南](./ASPECT_RATIO_USAGE_GUIDE.md) - 详细的功能说明和使用案例
- [API 配置指南](./components/KeySelection.tsx) - 在应用内点击 ? 查看

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

MIT License

## 🔗 相关链接

- [AI Studio](https://ai.studio/apps/drive/1wkj1Wo9G2rTr2nQ8UPbb3VheY-hoIFap)
- [Gemini API 文档](https://ai.google.dev/gemini-api/docs)
- [OpenAI API 文档](https://platform.openai.com/docs)
